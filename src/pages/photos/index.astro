---
import { Image } from "astro:assets";
import Page from "@/layouts/MainLayout.astro";
import { photos } from "@/content";

/**
 * Horizontally flowing masonry layout using (mostly) CSS.
 *
 * Use CSS grid to emulate a masonry layout. Calculate dimensions of each item
 * in the layout using fixed absolute units, then convert them into relative
 * units that scale with the viewport width.
 *
 * NOTE: calculations are done only for two and three column layouts.
 */
---

<style is:global>
/* Adapted from https://antfu.me/posts/sliding-enter-animation */
@keyframes slide-enter {
  0% { opacity: 0; transform: translateY(10px) }
  to { opacity: 1; transform: translateY(0) }
}

[data-slide-enter] {
  --enter-step: 0;
  --enter-delay: 90ms;
  --enter-start: 0ms;
}

[data-slide-controller=false] [data-slide-enter] { animation: none; }

@media (prefers-reduced-motion:no-preference) {
  [data-slide-enter] {
    animation: slide-enter .6s both 1;
    animation-delay: calc(var(--enter-step) * var(--enter-delay) + var(--enter-start));
  }
}

/* Begin masonry layout styles */
main {
  display: grid;
  grid-template-columns: 85vw;
  justify-content: center;
  gap: 6vw
}

@media (min-width: 640px) {
  main {
    --masonry-track: 1;
    --masonry-col: 45;
    --masonry-gap-factor: 2;
    grid-auto-rows: calc(1vw * var(--masonry-track));
    grid-template-columns: repeat(2, calc(1vw * var(--masonry-col)));
    gap: 0 calc(1vw * calc(var(--masonry-gap-factor) * var(--masonry-track)));
  }

  main > * {
    grid-row: span calc(calc(var(--masonry-col) * var(--ratio)) / var(--masonry-track));
    padding-block: calc(1vw * var(--masonry-track));
  }
}

@media (min-width: 1280px) {
  main {
    --masonry-track: 1;
    --masonry-col: 28;
    grid-template-columns: repeat(3, calc(1vw * var(--masonry-col)));
  }
}
</style>

<Page
  title="Photos"
  class="pt-30 md:pt-36"
>
  {
    photos.map((photo, i) => {
      const { slug, ...attrs } = photo;
      const { height, width } = photo.src;
      return (
        <div
          data-slide-enter
          style={{
            "--enter-step": i + 1,
            "--ratio": height / width,
          }}
        >
          <figure
            class="
              overflow-clip h-full
              bg-white border-white border-12
              transition duration-350
              shadow-lg hover:shadow-xl
            "
          >
            <a href={`/photos/${slug}`}>
              <Image { ...attrs } class="object-cover h-full w-full"/>
            </a>
          </figure>
        </div>
      )
    })
  }
</Page>
